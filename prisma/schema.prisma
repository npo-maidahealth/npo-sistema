generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                      Int                 @id @default(autoincrement())
  nome                    String
  email                   String              @unique
  senha_hash              String?
  whatsapp                String?
  regional                String?
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @default(now()) @updatedAt
  status                  UserStatus          @default(PENDENTE)
  regional_id             Int?
  cargo_id                Int?
  cargos                  CargosDoUsuario[]
  prioridadesSolicitadas  Prioridade[]        @relation("PrioridadeSolicitada")
  produtos                ProdutosDoUsuario[]
  protocolos_responsaveis Protocolo[]         @relation("Responsavel")
  protocolos_solicitados  Protocolo[]         @relation("Solicitante")
  tratativas              Tratativa[]
  Cargo                   Cargo?              @relation(fields: [cargo_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  regional                regional?           @relation(fields: [regional_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Cargo {
  id        Int               @id @default(autoincrement())
  nome      String            @unique
  createdAt DateTime          @default(now())
  updatedAt DateTime          @default(now()) @updatedAt
  usuarios  CargosDoUsuario[]
  Usuario   Usuario[]
}

model CargosDoUsuario {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  cargoId   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  cargo     Cargo    @relation(fields: [cargoId], references: [id])
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, cargoId])
}

model Protocolo {
  id                    Int         @id @default(autoincrement())
  protocolo_uid         String      @unique
  descricao             String
  tipo_automacao        String
  status                String
  nivel_dificuldade     Int?
  ferramentas_indicadas String?
  data_criacao          DateTime    @default(now())
  data_fechamento       DateTime?
  id_solicitante        Int
  id_responsavel        Int?
  descricao_resolucao   String?
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @default(now()) @updatedAt
  responsavel           Usuario?    @relation("Responsavel", fields: [id_responsavel], references: [id])
  solicitante           Usuario     @relation("Solicitante", fields: [id_solicitante], references: [id])
  tratativas            Tratativa[]
}

model Tratativa {
  id            Int       @id @default(autoincrement())
  id_protocolo  Int
  id_usuario    Int
  descricao     String
  data_criacao  DateTime  @default(now())
  tipo_mensagem String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt
  protocolo     Protocolo @relation(fields: [id_protocolo], references: [id])
  usuario       Usuario   @relation(fields: [id_usuario], references: [id])
}

model Produto {
  id          Int                 @id @default(autoincrement())
  nome        String              @unique
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @default(now()) @updatedAt
  prioridades Prioridade[]
  usuarios    ProdutosDoUsuario[]
}

model ProdutosDoUsuario {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  produtoId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  produto   Produto  @relation(fields: [produtoId], references: [id])
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, produtoId])
}

model Prioridade {
  id                     Int        @id @default(autoincrement())
  numeroGuia             String
  tipoGuia               String
  status                 String
  caracterAtendimento    String?
  observacao             String?
  produtoId              Int
  usuarioId              Int
  reguladorId            Int?
  dataCriacao            DateTime   @default(now())
  dataAtualizacao        DateTime?  @updatedAt
  capturada              Boolean    @default(false)
  vencimento             DateTime?
  autorizada             Boolean    @default(false)
  regulada               Boolean    @default(false)
  area                   String?
  atrasada               Boolean?
  atrasoRegulacao        String?
  beneficiario           String?
  beneficiarioNomeSocial String?
  cartaoBeneficiario     String?
  cpfBeneficiario        String?
  dataHoraSolicitacao    DateTime?
  dataPausaSla           DateTime?
  dataRegulacao          DateTime?
  dataSolicitacao        DateTime?
  dataVencimentoSla      DateTime?
  fila                   String?
  fonte                  String?    @default("ECO")
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @default(now()) @updatedAt
  vezesSolicitado        Int?       @default(1)
  produto                Produto    @relation(fields: [produtoId], references: [id])
  regulador              Regulador? @relation("PrioridadeRegulador", fields: [reguladorId], references: [id])
  usuario                Usuario    @relation("PrioridadeSolicitada", fields: [usuarioId], references: [id])
}

model Regulador {
  id               Int                @id @default(autoincrement())
  nome             String             @unique
  ativo            Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @default(now()) @updatedAt
  Escala_Regulacao Escala_Regulacao[]
  prioridades      Prioridade[]       @relation("PrioridadeRegulador")
}

model Escala_Regulacao {
  id          Int       @id(map: "Escala_pkey") @default(autoincrement())
  reguladorId Int
  diaSemana   Int
  turno       String
  horaInicio  String
  horaFim     String
  filas       String
  observacao  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now())
  Regulador   Regulador @relation(fields: [reguladorId], references: [id], map: "Escala_reguladorId_fkey")

  @@unique([reguladorId, diaSemana, turno], map: "Escala_reguladorId_diaSemana_turno_key")
}

model regional {
  id      Int       @id @default(autoincrement())
  nome    String    @db.VarChar(50)
  Usuario Usuario[]
}

model user_sessions {
  sid    String   @id @db.VarChar
  sess   Json     @db.Json
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_user_sessions_expire")
}

enum UserStatus {
  PENDENTE
  ATIVO
  INATIVO
}
